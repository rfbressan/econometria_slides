<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Econometria I</title>
    <meta charset="utf-8" />
    <meta name="author" content="Rafael Bressan" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="../css/scpo.css" type="text/css" />
    <link rel="stylesheet" href="../css/scpo-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Econometria I
]
.subtitle[
## Regress√£o Linear Simples
]
.author[
### Rafael Bressan
]
.date[
### UDESC/Esag </br> 2022-07-28
]

---


layout: true

&lt;div class="my-footer"&gt;&lt;img src="../img/logo/Esag.jpeg" style="height: 60px;"/&gt;&lt;/div&gt; 

---





# Hoje - Econometria de verdade finalmente ‚úåÔ∏è

* Popula√ß√£o vs Amostra

* Introdu√ß√£o ao ***Modelo de Regress√£o Linear Simples*** e ***M√≠nimos Quadrados Ordin√°rios (MQO)*** *estimativa*.

* Aplica√ß√£o emp√≠rica: *tamanho da turma* e *desempenho do aluno*

---

# Popula√ß√£o vs Amostra

Escrevemos nosso modelo populacional (simples)

$$ y_i = \beta_0 + \beta_1 x_i + u_i $$

--

* Os par√¢metros populacionais, `\(\beta_0\)` e `\(\beta_1\)`, s√£o definidos para que a equa√ß√£o acima seja uma "boa" representa√ß√£o

* Define o modelo de regress√£o linear (simples)

--

`$$y_i = \underbrace{\widehat\beta_0 + \widehat\beta_1 x_i}_{\widehat{y_i}} + e_i$$`

* Equivalente amostral: `\(y_i=\widehat{y_i}+e_i\)`

* Observa√ß√£o = Previs√£o + res√≠duo

---

# Popula√ß√£o *vs.* amostra

**Pergunta:** Por que nos preocupamos com *popula√ß√£o vs. amostra*?

--



.pull-left[

&lt;img src="chapter_slr_pt_files/figure-html/pop1-1.svg" width="400px" style="display: block; margin: auto;" /&gt;

.center[**Popula√ß√£o**]

]

--

.pull-right[

&lt;img src="chapter_slr_pt_files/figure-html/scatter1-1.svg" width="400px" height="250px" style="display: block; margin: auto;" /&gt;

.center[**Rela√ß√£o Populacional**]

$$ y_i = 2.53 + 0.57 x_i + u_i $$

$$ y_i = \beta_0 + \beta_1 x_i + u_i $$
]

---

.pull-left[

&lt;img src="chapter_slr_pt_files/figure-html/sample1-1.svg" style="display: block; margin: auto;" /&gt;

.center[**Amostra 1:** 30 indiv√≠duos aleat√≥rios]

]


.pull-right[

&lt;img src="chapter_slr_pt_files/figure-html/sample1 scatter-1.svg" height="350px" style="display: block; margin: auto;" /&gt;

.center[

**Rela√ß√£o Populacional**
&lt;br&gt;
`\(y_i = 2.53 + 0.57 x_i + u_i\)`

**Rela√ß√£o Amostral**
&lt;br&gt;
`\(\hat{y}_i = 2.36 + 0.61 x_i\)`
]

]

---
count: false

.pull-left[

&lt;img src="chapter_slr_pt_files/figure-html/sample2-1.svg" style="display: block; margin: auto;" /&gt;

.center[**Amostra 2:** 30 indiv√≠duos aleat√≥rios]

]

.pull-right[

&lt;img src="chapter_slr_pt_files/figure-html/sample2 scatter-1.svg" height="350px" style="display: block; margin: auto;" /&gt;

.center[

**Rela√ß√£o Populacional**
&lt;br&gt;
`\(y_i = 2.53 + 0.57 x_i + u_i\)`

**Rela√ß√£o Amostral**
&lt;br&gt;
`\(\hat{y}_i = 2.79 + 0.56 x_i\)`

]

]
---
count: false

.pull-left[

&lt;img src="chapter_slr_pt_files/figure-html/sample3-1.svg" style="display: block; margin: auto;" /&gt;

.center[**Amostra 3:** 30 indiv√≠duos aleat√≥rios]

]

.pull-right[

&lt;img src="chapter_slr_pt_files/figure-html/sample3 scatter-1.svg" height="350px" style="display: block; margin: auto;" /&gt;

.center[

**Rela√ß√£o Populacional**
&lt;br&gt;
`\(y_i = 2.53 + 0.57 x_i + u_i\)`

**Rela√ß√£o Amostral**
&lt;br&gt;
`\(\hat{y}_i = 3.21 + 0.45 x_i\)`

]

]

---
layout: false
class: clear, middle

Vamos repetir isso ***10.000 vezes***.

Este exerc√≠cio √© chamado de simula√ß√£o (Monte Carlo).

---
layout: true

&lt;div class="my-footer"&gt;&lt;img src="../img/logo/Esag.jpeg" style="height: 60px;"/&gt;&lt;/div&gt; 

---


# Popula√ß√£o *vs.* amostra

**Pergunta:** Por que nos preocupamos com *popula√ß√£o vs. amostra*?

--

.pull-left[
&lt;img src="chapter_slr_pt_files/figure-html/simulation scatter2-1.png" height="400px" style="display: block; margin: auto;" /&gt;
]

--

.pull-right[

- Em **m√©dia**, nossas linhas de regress√£o combinam muito bem com a linha populacional.

- No entanto, **linhas individuais** (amostras) podem realmente errar o alvo.

- Diferen√ßas entre amostras individuais e a popula√ß√£o levam a uma **incerteza** para o econometrista.

]

---

# Popula√ß√£o *vs.* amostra

**Pergunta:** Por que nos preocupamos com *popula√ß√£o vs. amostra*?


**Resposta:** Incerteza importa.

`\(\hat{\beta}\)` em si √© uma vari√°vel aleat√≥ria dependente da amostra que √© colhida. Quando pegamos uma amostra e fazemos uma regress√£o, n√£o sabemos se √© uma amostra 'boa' ( `\(\hat{\beta}\)` est√° pr√≥ximo de `\(\beta\)`) ou uma 'amostra ruim' (nossa amostra difere muito da popula√ß√£o).

---

# Popula√ß√£o *vs.* amostra


## Incerteza

Manter o controle dessa incerteza ser√° um conceito-chave em toda a nossa disciplina

- Estimativa de erros-padr√£o para nossas estimativas.

- Testar hip√≥teses.

- Corre√ß√£o de heterocedasticidade e autocorrela√ß√£o.

--

Primeiro, vamos relembrar como obtemos essas estimativas de regress√£o (incertas).

---
# Regress√£o Linear Simples

## Estimador

Podemos estimar uma linha de regress√£o em .mono[R] (`lm(y ~ x, my_data)`) e .mono[Stata] (`reg y x`). Mas de onde v√™m essas estimativas?

Alguns slides atr√°s:

&gt; $$ \hat{y}_i = \hat{\beta}_0 + \hat{\beta}_1 x_i $$
&gt; que nos d√° a linha de ***melhor ajuste*** em nosso conjunto de dados.
Mas o que queremos dizer com "linha de melhor ajuste"?

---

# Ser o "melhor"

**Pergunta:** O que queremos dizer com *linha de melhor ajuste*?

--

**Respostas:**

- Em geral (econometria), *linha de melhor ajuste* significa a linha que minimiza a soma dos res√≠duos ao quadrado (SQR):

.center[

`\(\text{SQR} = \sum_{i = 1}^{n} e_i^2\quad\)` onde `\(\quad e_i = y_i - \hat{y}_i\)`

]

- Os **m√≠nimos quadrados ordin√°rios** (**MQO**) minimizam a soma dos res√≠duos ao quadrado.
- Com base em um conjunto de hip√≥teses (geralmente aceit√°veis), MQO:
   - √â n√£o-viesado (e consistente)
   - √â o *melhor* estimador linear n√£o-viesado (vari√¢ncia m√≠nima) (BLUE)

---

# OLS *vs.* outras linhas/estimadores


---

# Tamanho da turma e desempenho dos alunos

* Quais pol√≠ticas *conduzem* a um melhor aprendizado dos alunos?

* A redu√ß√£o do tamanho das turmas est√° no centro dos debates sobre pol√≠ticas educacionais h√° *d√©cadas*.

--

* Usaremos dados de um artigo famoso de [Joshua Angrist e Victor Lavy (1999)](https://economics.mit.edu/files/8273).

* Consiste em resultados de testes e caracter√≠sticas de classe/escola para alunos da quinta s√©rie (10-11 anos) em escolas prim√°rias p√∫blicas judaicas em Israel em 1991.

* Testes nacionais mediram habilidades de *matem√°tica* e (hebraico) de *leitura*. As pontua√ß√µes brutas foram dimensionadas de 1 a 100.

---

class:: inverse

# Tarefa 1: Conhecendo os dados

1. Carregue os dados [daqui](https://www.dropbox.com/s/wwp2cs9f0dubmhr/grade5.dta?dl=1) como `grades`. *Dica: Use `read_dta` do pacote `haven` para importar o arquivo, que possui o formato .dta.* (FYI: *.dta* √© a extens√£o de arquivos de dados do [*Stata*](https://www.stata.com/))

1. Descreva o conjunto de dados:

   * Qual √© a unidade de observa√ß√£o, ou seja, a que corresponde cada linha?
   * Quantas observa√ß√µes existem?
   * Visualize o conjunto de dados. Que vari√°veis temos? A que correspondem as vari√°veis `avgmath` e `avgverb`?
   * Use a fun√ß√£o `skim` do pacote `skimr` para obter estat√≠sticas resumidas comuns para as vari√°veis `classize`, `avgmath` e `avgverb`. (*Dica: use `dplyr` para `selecionar` as vari√°veis e ent√£o simplesmente canalize (pipe `%&gt;%`) `skim()`.*)

1. Calcule a correla√ß√£o entre o tamanho da turma e as notas de matem√°tica e hebraico. A rela√ß√£o √© positiva/negativa, forte/fraca?



---

# Tamanho da turma e desempenho: gr√°fico de dispers√£o

.pull-left[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-2-1.svg" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-3-1.svg" style="display: block; margin: auto;" /&gt;
]

--

* Associa√ß√£o um tanto positiva conforme sugerido pelas correla√ß√µes. Vamos calcular a pontua√ß√£o m√©dia por tamanho de turma para ver as coisas com mais clareza!

---

# Tamanho da turma e desempenho: gr√°fico de dispers√£o agrupado

.pull-left[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-4-1.svg" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-5-1.svg" style="display: block; margin: auto;" /&gt;
]

---

# Tamanho da turma e desempenho: gr√°fico de dispers√£o agrupado

* Vamos nos concentrar primeiro nas pontua√ß√µes de matem√°tica e, para simplificar visualmente, ampliaremos

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-6-1.svg" style="display: block; margin: auto;" /&gt;

---

# Tamanho da turma e desempenho: linha de regress√£o

Como resumir visualmente a rela√ß√£o: **uma linha atrav√©s do gr√°fico de dispers√£o**

--

.left-wide[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-7-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;
]

--

.right-thin[
&lt;br&gt;

* Uma *linha*! Excelente. Mas **qual** linha? Esta?

* Essa √© uma linha *plana*. Mas a pontua√ß√£o m√©dia em matem√°tica *aumenta* com o tamanho da turma üò©

]

---

# Tamanho da turma e desempenho: linha de regress√£o

Como resumir visualmente a rela√ß√£o: **uma linha atrav√©s do gr√°fico de dispers√£o**

.left-wide[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-8-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;
]

.right-thin[
&lt;br&gt;

* **Aquela**?

* Um pouco melhor! Tem um **coeficiente angular** e um **intercepto** üòê

* Precisamos de uma regra para decidir! 

]


---

# Regress√£o Linear Simples

Vamos formalizar um pouco o que estamos fazendo at√© agora.

* Estamos interessados na rela√ß√£o entre duas vari√°veis:

--

   * uma __vari√°vel de resultado__ (tamb√©m chamada de __vari√°vel dependente__):
   *pontua√ß√£o m√©dia em matem√°tica* `\((y)\)`
  
--
  
   * uma __vari√°vel explicativa__ (tamb√©m chamada de __vari√°vel independente__ ou __regressor__):
   *tamanho da turma* `\((x)\)`
  
--

* Para cada classe `\(i\)` observamos o par `\(\{(x_i, y_i)\}_{i\in\mathcal{I}}\)` e, portanto, podemos tra√ßar a *distribui√ß√£o conjunta* do tamanho da classe e da pontua√ß√£o m√©dia em matem√°tica.

--

* Resumimos essa rela√ß√£o com uma linha (por enquanto). A equa√ß√£o para tal linha com um intercepto `\(b_0\)` e uma inclina√ß√£o (ou coeficiente angular) `\(b_1\)` √©:
     $$
     \widehat{y}_i = b\_0 + b\_1 x\_i
     $$

--

* `\(\widehat{y}_i\)` √© nossa *previs√£o* para `\(y\)` na observa√ß√£o `\(i\)` `\((y_i)\)` dado nosso modelo (ou seja, a linha).

---

# Regress√£o Linear Simples: Res√≠duos

* Se todos os pontos estivessem __sobre__ a linha, ent√£o `\(\widehat{y}_i = y_i\)`, e n√£o haveria res√≠duos.

--

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-9-1.svg" style="display: block; margin: auto;" /&gt;

---

# Regress√£o Linear Simples: Res√≠duos

* Se todos os pontos estivessem __sobre__ a linha, ent√£o `\(\widehat{y}_i = y_i\)`, e n√£o haveria res√≠duos.

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-10-1.svg" style="display: block; margin: auto;" /&gt;

---

# Regress√£o Linear Simples: Res√≠duos

* Se todos os pontos estivessem __sobre__ a linha, ent√£o `\(\widehat{y}_i = y_i\)`, e n√£o haveria res√≠duos.

* No entanto, como na maioria dos casos a *vari√°vel dependente* `\((y)\)` n√£o √© explicada *apenas*  pela *vari√°vel independente* escolhida `\((x)\)`, `\(\widehat{y}_i \neq y_i\)`, ou seja, exite um __erro__ de previs√£o.
Este __erro__&lt;sup&gt;1&lt;/sup&gt; √© chamado de __res√≠duo__.

.footnote[
[1]: Aqui o termo erro n√£o se refere ao erro populacional, outro conceito.
]

--

* No ponto `\((x_i,y_i)\)`, denotamos esse res√≠duo por `\(e_i\)` .

--

* Os *dados reais* `\((x_i,y_i)\)` podem ser escritos como *previs√£o + res√≠duo*:
  $$
  y_i = \widehat y_i + e_i \implies y_i = b_0 + b_1 x_i + e_i
  $$


---

# Regress√£o linear simples: graficamente

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-11-1.svg" style="display: block; margin: auto;" /&gt;

---

# Regress√£o linear simples: graficamente

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-12-1.svg" style="display: block; margin: auto;" /&gt;

---

# Regress√£o linear simples: graficamente

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-13-1.svg" style="display: block; margin: auto;" /&gt;

---

# Regress√£o linear simples: graficamente

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-14-1.svg" style="display: block; margin: auto;" /&gt;

---

# Regress√£o linear simples: graficamente

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-15-1.svg" style="display: block; margin: auto;" /&gt;

---

# Regress√£o linear simples: graficamente

.left-wide[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-16-1.svg" width="100%" style="display: block; margin: auto;" /&gt;
]

.right-thin[
&lt;br&gt;
&lt;br&gt;
.udescgreen.big.center[**Qual crit√©rio de ajuste utilizar?**]
]
---

# **M**√≠nimos **Q**uadrados **O**rdin√°rios (MQO)

--

* Erros de sinal diferente `\((+/-)\)` se cancelam, ent√£o consideramos **res√≠duos ao quadrado**
`$$\forall i \in \mathcal{I} = [1, \ldots, N], \quad e_i^2 = (y_i - \widehat y_i)^2 = (y_i - b_0 - b_1 x_i)^2$$`

--
.pull-left[
&lt;br&gt;
* Escolha `\((b_0,b_1)\)` tal que: 

`$$(b_0,b_1) = \underset{b_0, b_1}{\arg\min}\sum_{i = 1}^N e_1^2 + \dots + e_N^2$$`
]

--

.pull-right[
&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-17-1.svg" style="display: block; margin: auto;" /&gt;
]

---

# **M**√≠nimos **Q**uadrados **O**rdin√°rios (MQO)

* Escolha `\((b_0,b_1)\)` tal que `\(\sum_{i = 1}^N e_1^2 + \dots + e_N^2\)` seja **o m√≠nimo poss√≠vel**.

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-18-1.svg" style="display: block; margin: auto;" /&gt;

---

# **M**√≠nimos **Q**uadrados **O**rdin√°rios (MQO)

&lt;iframe src="https://gustavek.shinyapps.io/reg_simple/" width="100%" height="400px" data-external="1" style="border: none;"&gt;&lt;/iframe&gt;

---

# **M**√≠nimos **Q**uadrados **O**rdin√°rios (MQO)

&lt;iframe src="https://gustavek.shinyapps.io/SSR_cone/" width="100%" height="400px" data-external="1" style="border: none;"&gt;&lt;/iframe&gt;

---

# **M**√≠nimos **Q**uadrados **O**rdin√°rios (MQO): Coeficientes

* **MQO**: m√©todo de *estimativa* que consiste em minimizar a soma dos quadrados dos res√≠duos.

* Produz solu√ß√µes __√∫nicas__ para este problema de miniza√ß√£o. .udescgreen[_Como?_]

* Ent√£o, quais s√£o as f√≥rmulas para `\(b_0\)` (intercepto) e `\(b_1\)` (inclina√ß√£o)?

--

* Em nosso caso de vari√°vel independente √∫nica:

&gt; ### __Inclina√ß√£o: `\(b_1^{OLS} = \frac{cov(x,y)}{var(x)}\)` `\(\hspace{2cm}\)` Intercepto: `\(b_0^{OLS} = \bar{y } - b_1\bar{x}\)`__

--

* Essas f√≥rmulas n√£o surgem como m√°gica. Elas podem ser encontradas resolvendo a minimiza√ß√£o de erros quadr√°ticos. A matem√°tica pode ser encontrada [aqui](https://www.youtube.com/watch?v=Hi5EJnBHFB4) para quem estiver interessado.

---

# **M**√≠nimos **Q**uadrados **O**rdin√°rios (MQO): Interpreta√ß√£o

Por enquanto, suponha que tanto a vari√°vel dependente `\((y)\)` quanto a vari√°vel independente `\((x)\)` sejam num√©ricas.

--

&gt; Intercepto `\((b_0)\)`: **O valor previsto de `\(y\)` quando `\(x = 0\)`.**

--

&gt; Inclina√ß√£o `\((b_1)\)`: **A mudan√ßa prevista, em m√©dia, no valor de `\(y\)` *associada* a um aumento de uma unidade em `\(x\)`.**

--

* ‚ö†Ô∏è Observe que usamos o termo *associada*, **claramente evitando interpretar `\(b_1\)` como o impacto causal de `\(x\)` em `\(y\)`**. Para fazer tal afirma√ß√£o, precisamos que algumas condi√ß√µes espec√≠ficas sejam atendidas. Este √© o ramo da econometria que trata de ***infer√™ncia causal***.

--
 
* Observe tamb√©m que a unidade de `\(x\)` √© importante para a interpreta√ß√£o (e magnitude!) de `\(b_1\)`.

--

* **Voc√™ precisa ser expl√≠cito sobre qual √© a unidade de `\(x\)`!**

---

# MQO com o `R`

* Em `R`, as regress√µes OLS s√£o estimadas usando a fun√ß√£o `lm`.

* √â assim que funciona:

  
  ```r
  lm(formula = dep_var ~  indep_var, data = df)
  ```
--

## Tamanho da turma e desempenho dos alunos

Vamos estimar o seguinte modelo por MQO: `\(\textrm{mtm_media}_i = b_0 + b_1 \textrm{tamanho}_i + e_i\)`

.pull-left[

```r
# Regress√£o MQO da pontua√ß√£o m√©dia de matem√°tica 
# no tamanho da turma 
lm(avgmath_cs ~ classize, grades_avg_cs) 
```
]

.pull-right[

```
## 
## Call:
## lm(formula = avgmath_cs ~ classize, data = grades_avg_cs)
## 
## Coefficients:
## (Intercept)     classize  
##     61.1092       0.1913
```
]

---

# **M**√≠nimos **Q**uadrados **O**rdin√°rios (MQO): Previs√£o


```
## 
## Call:
## lm(formula = avgmath_cs ~ classize, data = grades_avg_cs)
## 
## Coefficients:
## (Intercept)     classize  
##     61.1092       0.1913
```

--

Isso implica (abstraindo o subscrito `\(_i\)` para simplificar):


$$
`\begin{align}
\widehat y &amp;= b_0 + b_1 x \\
\widehat {\text{m√©dia de matem√°tica}} &amp;= b_0 + b_1 \cdot \text{tamanho da turma} \\
\widehat {\text{m√©dia de matem√°tica}} &amp;= 61,11 + 0,19 \cdot \text{tamanho da turma}
\end{align}`
$$

--

Qual √© a pontua√ß√£o m√©dia prevista para uma turma de 26 alunos? (Usando os coeficientes *econtrados*.)

$$
`\begin{aligned}
\widehat {\text{m√©dia de matem√°tica}} &amp;= 61.11 + 0.19 \cdot 26 \\
\widehat {\text{m√©dia de matem√°tica}} &amp;= 66.08
\end{aligned}`
$$

---

class: inverse

# Tarefa 2: Regress√£o MQO


Execute o seguinte c√≥digo para agregar os dados no n√≠vel de tamanho da classe:


```r
grades_avg_cs &lt;- grades %&gt;%
  group_by(classize) %&gt;%
  summarise(avgmath_cs = mean(avgmath),
            avgverb_cs = mean(avgverb))
```

1. Regredir a pontua√ß√£o verbal m√©dia (vari√°vel dependente) no tamanho da turma (vari√°vel independente). Interprete os coeficientes.

1. Calcule os coeficientes MQO `\(b_0\)` e `\(b_1\)` da regress√£o anterior usando as f√≥rmulas do slide 25. (*Dica:* voc√™ precisa usar as fun√ß√µes `cov`, `var` e `mean`.)

1. Rode a regress√£o com a fun√ß√£o `lm` e compare os coeficientes obtidos.

1. Qual √© a pontua√ß√£o verbal m√©dia prevista quando o tamanho da turma √© igual a 0? (Isso faz sentido?!)

1. Qual √© a pontua√ß√£o verbal m√©dia prevista quando o tamanho da turma √© igual a 30 alunos?
---

# Previs√µes e Res√≠duos: Propriedades

.pull-left[
* __A m√©dia (ou soma) dos res√≠duos √© 0.__
   `$$\begin{align} \frac{1}{N} \sum_{i=1}^N e_i &amp;= \frac{1}{N} \sum_{i=1}^N (y_i - \widehat y_i ) \\ &amp;= \bar{y} - \frac{1}{N} \sum_{i=1}^N \widehat{y}_i \\\ &amp;= 0 \end{align}$$`

* __A m√©dia de `\(\widehat{y}_i\)` √© igual a `\(\bar{y}\)`.__
     `$$\begin{align} \frac{1}{N} \sum_{i=1}^N \widehat{y}_i &amp;= \frac{1}{N} \sum_{i=1}^N b_0 + b_1 x_i \\ &amp;= b_0 + b_1 \bar{x} = \bar{y} \end{align}$$`

]
--

.pull-right[
* __ Regressor e res√≠duos n√£o s√£o correlacionados (por imposi√ß√£o).__


   `$$Cov(x_i, e_i) = 0$$`


* __Previs√£o e res√≠duos n√£o s√£o correlacionados.__

   `$$\begin{align} Cov(\widehat y_i, e_i) &amp;= Cov(b_0 + b_1x_i, e_i) \\ &amp;= b_1Cov(x_i,e_i) \\ &amp;= 0 \end{align}$$`
  
   J√° que `\(Cov(a + bx, y) = bCov(x,y)\)`.

]

---

# Suposi√ß√£o de Linearidade: Visualize seus Dados!

* √â importante ter em mente que covari√¢ncia, correla√ß√£o e regress√£o simples MQO medem apenas **rela√ß√µes lineares** entre duas vari√°veis.

* Dois conjuntos de dados com correla√ß√µes *id√™nticas* e linhas de regress√£o podem parecer *muito* diferentes.

---

# Suposi√ß√£o de linearidade: Anscombe

* Francis Anscombe (1973) apresentou 4 conjuntos de dados com estat√≠sticas id√™nticas. Mas olhe!

.left-wide[

&lt;img src="chapter_slr_pt_files/figure-html/unnamed-chunk-26-1.svg" style="display: block; margin: auto;" /&gt;
]

--

.right-thin[
&lt;/br&gt;
&lt;/br&gt;

&lt;table class="table table-striped" style="font-size: 20px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; dataset &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; cov &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; var(y) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; var(x) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.501 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.127 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.128 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.497 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.123 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.499 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.123 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]
---

# Rela√ß√µes n√£o-lineares nos dados?

.pull-left[
* Podemos acomodar rela√ß√µes n√£o lineares em regress√µes.

* Basta adicionar um termo de *ordem superior* como este:
     $$
     y_i = b_0 + b_1 x_i + b_2 x_i^2 + e_i
     $$
    
* Esta √© uma __regress√£o m√∫ltipla__ (em 2 semanas!)
]
--

.pull-right[
* Por exemplo, suponha que tenhamos esses dados e ajustemos o modelo de regress√£o anterior:
    &lt;img src="chapter_slr_pt_files/figure-html/non-line-cars-ols2-1.svg" style="display: block; margin: auto;" /&gt;
]

---

# An√°lise de vari√¢ncia - ANOVA

* Lembre-se que `\(y_i = \widehat{y}_i + e_i\)`.

* Temos a seguinte decomposi√ß√£o:
    `$$\begin{align} Var(y) &amp;= Var(\widehat{y} + e)\\&amp;= Var(\widehat{y}) + Var(e) + 2 Cov(\widehat{y}, e)\\&amp;= Var(\widehat{y}) + Var(e)\end{align}$$`
    

* __Varia√ß√£o total (SST) = explicado pelo modelo(SQR) + Inexplic√°vel (SSR)__

---

# Qualidade de ajuste

* O __ `\(R^2\)` __ mede qu√£o bem o __model se ajusta aos dados__.

--

$$
R^2 = \frac{\text{vari√¢ncia explicada}}{\text{vari√¢ncia total}} = \frac{SQR}{SST} = 1 - \frac{SSR}{SST}\in[0,1]
$$

--
    
* `\(R^2\)` pr√≥ximo de `\(1\)` indica um poder explicativo __muito ***alto***__ do modelo.

* `\(R^2\)` pr√≥ximo a `\(0\)` indica um poder explicativo __muito ***baixo***__ do modelo.

--

* *Interpreta√ß√£o:* um `\(R^2\)` de 0,5, por exemplo, significa que a varia√ß√£o em `\(x\)` "explica" 50% da varia√ß√£o em `\(y\)`.

--
    
* ‚ö†Ô∏è Baixo `\(R^2\)` __N√ÉO__ significa que um modelo √© in√∫til! Lembre-se de que a econometria est√° interessada muitas vezes em ***mecanismos causais***, n√£o necessariamente em previs√£o!

--
    
* ‚ö†Ô∏è O `\(R^2\)` __N√ÉO__ √© um indicador de um relacionamento causal!

---

class: inverse

# Tarefa 3: `\(R^2\)` e qualidade de ajuste


1. Regresse `avgmath_cs` em `classize`. Atribua a um objeto `math_reg`.

1. Passe `math_reg` na fun√ß√£o `summary()`. Qual √© o (m√∫ltiplo) `\(R^2\)` para esta regress√£o? Como voc√™ pode interpret√°-lo?

1. Calcule a correla√ß√£o ao quadrado entre `classize` e `avgmath_cs`. O que isso lhe diz sobre a rela√ß√£o entre `\(R^2\)` e a correla√ß√£o em uma regress√£o com apenas um regressor?

1. Repita os passos 1 e 2 para `avgverb_cs`. Para qual exame a varia√ß√£o no tamanho da turma explica mais a varia√ß√£o nas notas dos alunos?

1. (Opcional) Instale e carregue o pacote `broom`. Passe `math_reg` na fun√ß√£o `augment()` e atribua-o a um novo objeto. Use a varia√ß√£o em `avgmath_cs` (SST) e a varia√ß√£o em `.fitted` (valores previstos; SQR) para encontrar o `\(R^2\)` usando a f√≥rmula do slide anterior.

---


layout: false

class: title-slide-final, middle
background-image: url(../img/logo/UdescEsag.jpeg)
background-size: 350px
background-position: 9% 9%

# AT√â A PR√ìXIMA AULA!

Com a Lista 1 feita! ‚úÖ

.footnote[
[1]: Este slides foram baseados nas aulas de econometria da [SciencesPo Department of Economics](https://github.com/ScPoEcon/ScPoEconometrics-Slides)
]


|                                                                                                            |                                   |
| :--------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| &lt;a href="https://github.com/rfbressan/econometria_slides"&gt;.ScPored[&lt;i class="fa fa-link fa-fw"&gt;&lt;/i&gt;] | Slides |
| &lt;a href="http://github.com/rfbressan"&gt;.ScPored[&lt;i class="fa fa-github fa-fw"&gt;&lt;/i&gt;] | @rfbressan |
| &lt;a href="https://raw.githack.com/rfbressan/econometria_slides/master/chapter_slr/lista_slr_pt.html"&gt;.ScPored[&lt;i class="fa fa-list fa-fw"&gt;&lt;/i&gt;] | Lista 1 |
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../js/ru_xaringan.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
